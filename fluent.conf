<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<source>
  @type udp
  tag kong
  format json
  port 20001
  bind 0.0.0.0
</source>

<system>
  log_level error
</system>

<filter *.**>
  @type parser
  format json
  key_name log
  reserve_data true
</filter>

<match fluent.**>
  @type stdout
</match>

<match system.**>
    @type copy
    <store>
    @type elasticsearch
    hosts "#{ENV['FLUENT_ELASTICSEARCH_HOSTS']}"
    logstash_format true
    logstash_prefix log-system
    logstash_dateformat %Y.%m
    type_name ${tag}

    flush_interval 5s
    </store>
    <store>
    @type stdout
    </store>
</match>

<match application.**>
    @type copy
    <store>
    @type elasticsearch
    hosts "#{ENV['FLUENT_ELASTICSEARCH_HOSTS']}"
    index_name log-application
    type_name ${tag}

    flush_interval 5s
    </store>
    <store>
    @type stdout
    </store>
</match>

<match kong.**>
    @type copy
    <store>
    @type elasticsearch
    hosts "#{ENV['FLUENT_ELASTICSEARCH_HOSTS']}"
    logstash_format true
    logstash_prefix log-apigetway
    logstash_dateformat %Y.%m
    type_name ${tag}

    flush_interval 5s
    </store>
    <store>
    @type stdout
    </store>
</match>
